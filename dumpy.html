<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dump File Encryptor/Decryptor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            flex-direction: column;
        }
        .container {
            text-align: center;
        }
        .file-input {
            margin-bottom: 10px;
        }
        .buttons {
            margin-top: 10px;
        }
        .buttons button {
            margin: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Dump File Encryptor/Decryptor</h1>
        <input type="file" id="fileInput" class="file-input" accept=".dump">
        <br>
        <label for="isDecrypted">Is the file already decrypted?</label>
        <input type="checkbox" id="isDecrypted">
        <div class="buttons">
            <button id="decryptButton">Decrypt</button>
            <button id="encryptButton">Encrypt</button>
        </div>
        <br>
        <a id="downloadLink" style="display: none;">Download</a>
    </div>

    <script>
        const fileInput = document.getElementById('fileInput');
        const decryptButton = document.getElementById('decryptButton');
        const encryptButton = document.getElementById('encryptButton');
        const downloadLink = document.getElementById('downloadLink');
        const isDecrypted = document.getElementById('isDecrypted');
        let fileContent;

        fileInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    fileContent = new Uint8Array(e.target.result);
                };
                reader.readAsArrayBuffer(file);
            }
        });

        decryptButton.addEventListener('click', () => {
            if (fileContent && !isDecrypted.checked) {
                processFile(fileContent, false).then(decryptedData => {
                    createDownloadLink(decryptedData, 'decrypted_output.dump');
                    isDecrypted.checked = true;
                });
            } else {
                alert('File is either already decrypted or not loaded.');
            }
        });

        encryptButton.addEventListener('click', () => {
            if (fileContent && isDecrypted.checked) {
                processFile(fileContent, true).then(encryptedData => {
                    createDownloadLink(encryptedData, 'encrypted_output.dump');
                    isDecrypted.checked = false;
                });
            } else {
                alert('File is either already encrypted or not loaded.');
            }
        });

        function createDownloadLink(data, fileName) {
            const blob = new Blob([data], { type: 'application/octet-stream' });
            const url = URL.createObjectURL(blob);
            downloadLink.href = url;
            downloadLink.download = fileName;
            downloadLink.style.display = 'inline';
            downloadLink.textContent = `Download ${fileName}`;
        }

        async function processFile(data, encrypt) {
            const actikey = new Uint8Array([0x20, 0x43, 0x6F, 0x70, 0x79, 0x72, 0x69, 0x67, 0x68, 0x74, 0x20, 0x28, 0x43, 0x29, 0x20, 0x32, 0x30, 0x31, 0x30, 0x20, 0x41, 0x63, 0x74, 0x69, 0x76, 0x69, 0x73, 0x69, 0x6F, 0x6E, 0x2E, 0x20, 0x41, 0x6C, 0x6C, 0x20, 0x52, 0x69, 0x67, 0x68, 0x74, 0x73, 0x20, 0x52, 0x65, 0x73, 0x65, 0x72, 0x76, 0x65, 0x64, 0x2E, 0x20]);
            const keyInput = new Uint8Array(85);
            const processedData = new Uint8Array(1024);
            let tempData = new Uint8Array(16);
            keyInput.set(data.slice(0, 32), 0);
            keyInput.set(actikey, 33);

            for (let h = 0; h <= 63; h++) {
                if ((h - 3) % 4 === 0 || h < 8 || h === 34 || h === 62) {
                    processedData.set(data.slice(h * 16, (h + 1) * 16), h * 16);
                } else {
                    keyInput[32] = h;
                    tempData = data.slice(h * 16, (h + 1) * 16);
                    const key = await crypto.subtle.digest('MD5', keyInput);
                    const cryptoKey = await crypto.subtle.importKey('raw', key, { name: 'AES-ECB' }, false, [encrypt ? 'encrypt' : 'decrypt']);
                    const processedBlock = await crypto.subtle[encrypt ? 'encrypt' : 'decrypt']({ name: 'AES-ECB' }, cryptoKey, tempData);
                    processedData.set(new Uint8Array(processedBlock), h * 16);
                }
            }

            return processedData;
        }
    </script>
</body>
</html>
